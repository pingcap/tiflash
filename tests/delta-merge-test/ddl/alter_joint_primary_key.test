
>> drop table if exists dm_test

## tests for joint primary key
>> create table dm_test (
        a Int32,
        b Int32,
        c String,
        d FixedString(20)
   ) engine = DeltaMerge((a, b))

>> insert into table dm_test values(1, 2, 'hello TiFlash', 'hello world')

# drop a part of pk is forbidden
>> alter table dm_test drop column a
Received exception from server (version {#WORD}):
Code: 36. DB::Exception: Received from {#WORD} DB::Exception: Storage engine DeltaMerge doesn't support drop primary key / hidden column: a.

>> alter table dm_test drop column b
Received exception from server (version {#WORD}):
Code: 36. DB::Exception: Received from {#WORD} DB::Exception: Storage engine DeltaMerge doesn't support drop primary key / hidden column: b.

>> select * from dm_test
┌─a─┬─b─┬─c─────────────┬─d─────────────────────────────┐
│ 1 │ 2 │ hello TiFlash │ hello world\0\0\0\0\0\0\0\0\0 │
└───┴───┴───────────────┴───────────────────────────────┘
>> desc dm_test
┌─name──────────────┬─type────────────┬─default_type─┬─default_expression─┐
│ a                 │ Int32           │              │                    │
│ b                 │ Int32           │              │                    │
│ c                 │ String          │              │                    │
│ d                 │ FixedString(20) │              │                    │
│ _INTERNAL_VERSION │ UInt64          │              │                    │
│ _INTERNAL_DELMARK │ UInt8           │              │                    │
│ _tidb_rowid       │ Int64           │              │                    │
└───────────────────┴─────────────────┴──────────────┴────────────────────┘

>> alter table dm_test drop column c
>> desc dm_test
┌─name──────────────┬─type────────────┬─default_type─┬─default_expression─┐
│ a                 │ Int32           │              │                    │
│ b                 │ Int32           │              │                    │
│ d                 │ FixedString(20) │              │                    │
│ _INTERNAL_VERSION │ UInt64          │              │                    │
│ _INTERNAL_DELMARK │ UInt8           │              │                    │
│ _tidb_rowid       │ Int64           │              │                    │
└───────────────────┴─────────────────┴──────────────┴────────────────────┘
>> select * from dm_test
┌─a─┬─b─┬─d─────────────────────────────┐
│ 1 │ 2 │ hello world\0\0\0\0\0\0\0\0\0 │
└───┴───┴───────────────────────────────┘


>> alter table dm_test drop column d
>> select * from dm_test
┌─a─┬─b─┐
│ 1 │ 2 │
└───┴───┘
>> desc dm_test
┌─name──────────────┬─type───┬─default_type─┬─default_expression─┐
│ a                 │ Int32  │              │                    │
│ b                 │ Int32  │              │                    │
│ _INTERNAL_VERSION │ UInt64 │              │                    │
│ _INTERNAL_DELMARK │ UInt8  │              │                    │
│ _tidb_rowid       │ Int64  │              │                    │
└───────────────────┴────────┴──────────────┴────────────────────┘

## Clean up
>> drop table if exists dm_test
