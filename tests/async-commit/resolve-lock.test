mysql> drop table if exists test.t;
mysql> set @@global.tidb_enable_async_commit=1; set @@global.tidb_allow_batch_cop=0;
mysql> create table test.t (c1 varchar(64) primary key, c2 bigint);
mysql> alter table test.t set tiflash replica 1;
mysql> insert into test.t values ('1', 1), ('2', 2), ('3', 3);

func> wait_table test t

mysql> set @@tidb_isolation_read_engines='tiflash'; select * from test.t order by c1;
+----+------+
| c1 | c2   |
+----+------+
| 1  |    1 |
| 2  |    2 |
| 3  |    3 |
+----+------+

mysql> set @@tidb_isolation_read_engines='tikv'; update test.t set c2=c2+100;

=> DBGInvoke __sleep(5000)

mysql> set @@tidb_isolation_read_engines='tiflash'; select * from test.t order by c1;
+----+------+
| c1 | c2   |
+----+------+
| 1  |  101 |
| 2  |  102 |
| 3  |  103 |
+----+------+

mysql> set @@global.tidb_allow_batch_cop=2;

# TODO: test client-c about resolve lock

mysql> drop table if exists test.t;

