mysql> drop table if exists test.f;
mysql> CREATE TABLE test.f (a char(20),b varchar(20), id int);
mysql> insert into test.f values('abc','fzh',1);
mysql> insert into test.f values('pingcap','tidb',1);
mysql> insert into test.f values(null,null,null);
mysql> insert into test.f values(null,'std',null);
mysql> insert into test.f values('shipai',null,1);
mysql> alter table test.f set tiflash replica 1;

mysql> analyze table test.f;

func> wait_table test f

mysql> use test;  select t.c1,t.c2,a,b,id, count(*) from (select left(a,id) c1,right(b,id) c2, a, b, id from test.f) t group by t.c1, t.c2,a,b,id;
+------+------+---------+------+------+----------+
| c1   | c2   | a       | b    | id   | count(*) |
+------+------+---------+------+------+----------+
| s    | NULL | shipai  | NULL |    1 |        1 |
| p    | b    | pingcap | tidb |    1 |        1 |
| a    | h    | abc     | fzh  |    1 |        1 |
| NULL | NULL | NULL    | NULL | NULL |        1 |
| NULL | NULL | NULL    | std  | NULL |        1 |
+------+------+---------+------+------+----------+

mysql> use test;  select t.c1,t.c2,a,b,id, count(*) from (select left(a,id+10) c1,right(b,id+10) c2, a, b, id+10 as id from test.f) t group by t.c1, t.c2,a,b,id;
+---------+------+---------+------+----+----------+
| c1      | c2   | a       | b    | id | count(*) |
+---------+------+---------+------+----+----------+
| abc     | fzh  | abc     | fzh  | 11 |        1 |
| NULL    | NULL | NULL    | NULL | NULL |        1 |
| pingcap | tidb | pingcap | tidb | 11 |        1 |
| NULL    | NULL | NULL    | std  | NULL |        1 |
| shipai  | NULL | shipai  | NULL | 11 |        1 |
+---------+------+---------+------+----+----------+

mysql> use test; select t.c1,t.c2,a,b,id, count(*) from (select left(a,id-1) c1,right(b,id-1) c2, a, b, id-1 as id from test.f) t group by t.c1, t.c2,a,b,id;
+------+------+---------+------+----+----------+
| c1   | c2   | a       | b    | id | count(*) |
+------+------+---------+------+----+----------+
|      | NULL | shipai  | NULL |  0 |        1 |
|      |      | pingcap | tidb |  0 |        1 |
|      |      | abc     | fzh  |  0 |        1 |
| NULL | NULL | NULL    | NULL | NULL |        1 |
| NULL | NULL | NULL    | std  | NULL |        1 |
+------+------+---------+------+----+----------+
