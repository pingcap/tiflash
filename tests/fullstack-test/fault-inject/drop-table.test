
mysql> drop table if exists test.t
mysql> create table test.t(a int not null, b int not null)
mysql> alter table test.t set tiflash replica 1 location labels 'rack', 'host', 'abc'

SLEEP 15


mysql> insert into test.t values (1, 1)
mysql> insert into test.t values (1, 2)

SLEEP 15

>> DBGInvoke __try_flush()
>> DBGInvoke __init_fail_point()
>> DBGInvoke __enable_fail_point(exception_between_drop_meta_and_data)

mysql> truncate table test.t ;

SLEEP 15

mysql> insert into test.t values (1, 1)
mysql> insert into test.t values (1, 2)
mysql> select /*+ read_from_storage(tiflash[t]) */ * from test.t;

+---+---+
| a | b |
+---+---+
| 1 | 1 |
| 1 | 2 |
+---+---+

>> DBGInvoke __enable_fail_point(exception_drop_table_during_remove_meta)
mysql> truncate table test.t ;

SLEEP 15

mysql> insert into test.t values (1, 1)
mysql> insert into test.t values (1, 2)
mysql> select /*+ read_from_storage(tiflash[t]) */ * from test.t;

+---+---+
| a | b |
+---+---+
| 1 | 1 |
| 1 | 2 |
+---+---+

mysql> drop table if exists test.t

