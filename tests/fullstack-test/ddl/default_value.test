mysql> drop table if exists test.t
mysql> create table test.t(a int)
mysql> alter table test.t set tiflash replica 1
mysql> insert into test.t (a) values (1);
mysql> insert into test.t (a) values (1);
mysql> alter table test.t add column b year not null;

func> wait_table test t

>> DBGInvoke __try_flush()
mysql> set session tidb_isolation_read_engines='tiflash'; select /*+ read_from_storage(tiflash[t]) */ * from test.t;
+------+------+
| a    | b    |
+------+------+
|    1 | 2000 |
|    1 | 2000 |
+------+------+

mysql> alter table test.t add column c year not null;
mysql> set session tidb_isolation_read_engines='tiflash'; select /*+ read_from_storage(tiflash[t]) */ * from test.t;
+------+------+------+
| a    | b    | c    |
+------+------+------+
|    1 | 2000 | 2000 |
|    1 | 2000 | 2000 |
+------+------+------+

mysql> alter table test.t drop column b;
mysql> alter table test.t drop column c;

mysql> alter table test.t add column b1 bit(1) not null;
mysql> alter table test.t add column b2 bit(1) not null default b'0';
mysql> alter table test.t add column b3 bit(32) default 0x010203;
mysql> alter table test.t add column b4 bit(32) default b'000000010000001000000011';
mysql> alter table test.t add column b5 bit(32) default b'000000010000001000000011';
mysql> alter table test.t add column b6 bit(32) default b'000000010000001000000011';
mysql> alter table test.t add column b7 bit(32) not null default b'000000010000001000000011';
# TiDB is dumb, see https://github.com/pingcap/tidb/issues/17641 and https://github.com/pingcap/tidb/issues/17642
# Cannot add the following lines, which are supposed to give us a little more coverage, until TiDB stops being dumb.
# mysql> alter table test.t modify column b5 bit(32);
# mysql> alter table test.t modify column b6 bit(64);
# mysql> alter table test.t modify column b7 bit(32);

# MySQL client will mess up the raw bit value output so use hex function.
mysql> set session tidb_isolation_read_engines='tiflash'; select hex(b1), hex(b2), hex(b3), hex(b4), hex(b5), hex(b6), hex(b7) from test.t;
+---------+---------+---------+---------+---------+---------+---------+
| hex(b1) | hex(b2) | hex(b3) | hex(b4) | hex(b5) | hex(b6) | hex(b7) |
+---------+---------+---------+---------+---------+---------+---------+
| 0       | 0       | 10203   | 10203   | 10203   | 10203   | 10203   |
| 0       | 0       | 10203   | 10203   | 10203   | 10203   | 10203   |
+---------+---------+---------+---------+---------+---------+---------+

# new collation is disabled in TiDB by default, need to enable new collation to run this test
# mysql> alter table test.t add column b8 enum('ab','cd','ef') charset utf8mb4 collate utf8mb4_general_ci default 'EF';
# mysql> set session tidb_isolation_read_engines='tiflash'; select b8 from test.t;
# +----+
# | b8 |
# +----+
# | ef |
# | ef |
# +----+
