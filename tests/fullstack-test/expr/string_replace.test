mysql> drop table if exists test.t
mysql> create table test.t(a varchar(80))
mysql> alter table test.t set tiflash replica 1
mysql> insert into test.t values(NULL)
mysql> insert into test.t values('')
mysql> insert into test.t values('w')
mysql> insert into test.t values('ww')
mysql> insert into test.t values(' www ')
mysql> insert into test.t values('w w w')

func> wait_table test t

# Issue https://github.com/pingcap/tics/issues/1860

mysql> set @@tidb_isolation_read_engines='tiflash'; select replace(NULL, 'w', 'x') as x from test.t group by 1 order by 1
+------+
| x    |
+------+
| NULL |
+------+
mysql> set @@tidb_isolation_read_engines='tiflash'; select replace(a, 'w', 'x') as x from test.t group by 1 order by 1
+-------+
| x     |
+-------+
| NULL  |
|       |
|  xxx  |
| x x x |
| xx    |
+-------+
mysql> set @@tidb_isolation_read_engines='tiflash'; select replace(a, '', 'x') as x from test.t group by 1 order by 1
+-------+
| x     |
+-------+
| NULL  |
|       |
|  www  |
| w w w |
| ww    |
+-------+
mysql> set @@tidb_isolation_read_engines='tiflash'; select replace(a, NULL, 'x') as x from test.t group by 1 order by 1
+------+
| x    |
+------+
| NULL |
+------+
mysql> set @@tidb_isolation_read_engines='tiflash'; select replace(a, 'w', '') as x from test.t group by 1 order by 1
+------+
| x    |
+------+
| NULL |
|      |
|      |
+------+
mysql> set @@tidb_isolation_read_engines='tiflash'; select replace(a, 'w', 'ww') as x from test.t group by 1 order by 1
+----------+
| x        |
+----------+
| NULL     |
|          |
|  wwwwww  |
| ww ww ww |
| wwww     |
+----------+
mysql> set @@tidb_isolation_read_engines='tiflash'; select replace(a, 'ww', 'w') as x from test.t group by 1 order by 1
+-------+
| x     |
+-------+
| NULL  |
|       |
|  ww   |
| w     |
| w w w |
+-------+
mysql> set @@tidb_isolation_read_engines='tiflash'; select replace(a, 'w', NULL) as x from test.t group by 1 order by 1
+------+
| x    |
+------+
| NULL |
+------+

mysql> drop table if exists test.t

