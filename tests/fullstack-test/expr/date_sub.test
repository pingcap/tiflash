#mysql> drop table if exists test.t
#mysql> create table test.t(a datetime, b char(20), c int);
#mysql> alter table test.t set tiflash replica 1;
#mysql> insert into test.t values('2021-02-28 23:59:59', '2021-03-01', 1);
#mysql> insert into test.t values('2021-03-01', '2021-02-28 23:59:59', 2);
#mysql> insert into test.t values('2021-03-01', '2021-03-01', 3);
#mysql> insert into test.t values('2021-03-01', '2020-02-28', 4);
#mysql> insert into test.t values('2020-03-01', '2020-02-28', 5);
#mysql> insert into test.t values('2020-02-28 23:59:59', '2020-03-01', 6);
#mysql> insert into test.t values('2020-03-01', '2020-02-28 23:59:59', 7);
#mysql> insert into test.t values('2021-03-01', '2021-03-01', 8);
#mysql> insert into test.t values('2020-02-28', '2021-03-01', null);
#mysql> insert into test.t values('2020-02-28', '2020-03-01', 10);
#mysql> insert into test.t values(null, '2020-03-01', 10);
#mysql> insert into test.t values('2020-02-28', null, null);
#func> wait_table test t

#mysql> SELECT DATE_ADD('2018-05-01',INTERVAL 1 DAY);
mysql> set @@session.tidb_isolation_read_engines = "tikv";select count(*), date_sub(a, INTERVAL c DAY) from test.t group by 2;
+----------+-----------------------------+
| count(*) | date_sub(a, INTERVAL c DAY) |
+----------+-----------------------------+
|        1 | 2020-02-23 00:00:00         |
|        1 | 2021-02-21 00:00:00         |
|        1 | 2021-02-26 00:00:00         |
|        1 | 2021-02-27 00:00:00         |
|        1 | 2021-02-27 23:59:59         |
|        1 | 2021-02-25 00:00:00         |
|        1 | 2020-02-22 23:59:59         |
|        1 | 2020-02-25 00:00:00         |
|        3 | NULL                        |
|        1 | 2020-02-18 00:00:00         |
+----------+-----------------------------+

mysql> set @@session.tidb_isolation_read_engines = "tiflash";select count(*), date_sub(a, INTERVAL c DAY) from test.t group by 2;
+----------+-----------------------------+
| count(*) | date_sub(a, INTERVAL c DAY) |
+----------+-----------------------------+
|        1 | 2020-02-23 00:00:00         |
|        1 | 2021-02-21 00:00:00         |
|        1 | 2021-02-26 00:00:00         |
|        1 | 2021-02-27 00:00:00         |
|        1 | 2021-02-27 23:59:59         |
|        1 | 2021-02-25 00:00:00         |
|        1 | 2020-02-22 23:59:59         |
|        1 | 2020-02-25 00:00:00         |
|        3 | NULL                        |
|        1 | 2020-02-18 00:00:00         |
+----------+-----------------------------+

mysql> set @@session.tidb_isolation_read_engines = "tikv";select count(*), date_sub(b, INTERVAL c SECOND) from test.t group by 2;
+----------+-------------------------------------+
| count(*) | date_sub(b, INTERVAL c MICROSECOND) |
+----------+-------------------------------------+
|        1 | 2021-02-28 23:59:59.999992          |
|        2 | 2020-02-29 23:59:59.999990          |
|        1 | 2021-02-28 23:59:59.999997          |
|        1 | 2020-02-27 23:59:59.999995          |
|        1 | 2020-02-27 23:59:59.999996          |
|        1 | 2021-02-28 23:59:59.999999          |
|        1 | 2021-02-28 23:59:58.999998          |
|        1 | 2020-02-29 23:59:59.999994          |
|        2 | NULL                                |
|        1 | 2020-02-28 23:59:58.999993          |
+----------+-------------------------------------+

mysql> set @@session.tidb_isolation_read_engines = "tiflash";select count(*), date_sub(b, INTERVAL c SECOND) from test.t group by 2;
+----------+-------------------------------------+
| count(*) | date_sub(b, INTERVAL c MICROSECOND) |
+----------+-------------------------------------+
|        1 | 2021-02-28 23:59:59.999992          |
|        2 | 2020-02-29 23:59:59.999990          |
|        1 | 2021-02-28 23:59:59.999997          |
|        1 | 2020-02-27 23:59:59.999995          |
|        1 | 2020-02-27 23:59:59.999996          |
|        1 | 2021-02-28 23:59:59.999999          |
|        1 | 2021-02-28 23:59:58.999998          |
|        1 | 2020-02-29 23:59:59.999994          |
|        2 | NULL                                |
|        1 | 2020-02-28 23:59:58.999993          |
+----------+-------------------------------------+