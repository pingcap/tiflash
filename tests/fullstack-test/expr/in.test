mysql> drop table if exists test.t;
mysql> create table test.t(a int primary key, b int not null, c int);
mysql> insert into test.t values(0,0,0),(1,0,1),(2,0,null),(3,1,0),(4,1,1),(5,1,null),(6,0,0),(7,0,1),(8,0,null),(9,1,0),(10,1,1),(11,1,null);
mysql> alter table test.t set tiflash replica 1;
func> wait_table test t

mysql> set tidb_enforce_mpp=1; select avg(a or 1) in (0,0), avg(a or 1) in (1,1), avg(b or 1) in (0,0), avg(b or 1) in (1,1), avg(c or 1) in (0,0), avg(c or 1) in (1,1) from test.t group by a,b,c;
+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+
| avg(a or 1) in (0,0) | avg(a or 1) in (1,1) | avg(b or 1) in (0,0) | avg(b or 1) in (1,1) | avg(c or 1) in (0,0) | avg(c or 1) in (1,1) |
+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+
|                    0 |                    1 |                    0 |                    1 |                    0 |                    1 |
|                    0 |                    1 |                    0 |                    1 |                    0 |                    1 |
|                    0 |                    1 |                    0 |                    1 |                    0 |                    1 |
|                    0 |                    1 |                    0 |                    1 |                    0 |                    1 |
|                    0 |                    1 |                    0 |                    1 |                    0 |                    1 |
|                    0 |                    1 |                    0 |                    1 |                    0 |                    1 |
|                    0 |                    1 |                    0 |                    1 |                    0 |                    1 |
|                    0 |                    1 |                    0 |                    1 |                    0 |                    1 |
|                    0 |                    1 |                    0 |                    1 |                    0 |                    1 |
|                    0 |                    1 |                    0 |                    1 |                    0 |                    1 |
|                    0 |                    1 |                    0 |                    1 |                    0 |                    1 |
|                    0 |                    1 |                    0 |                    1 |                    0 |                    1 |
+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+
mysql> set tidb_enforce_mpp=1; select avg(a or 0) in (0,0), avg(a or 0) in (1,1), avg(b or 0) in (0,0), avg(b or 0) in (1,1), avg(c or 0) in (0,0), avg(c or 0) in (1,1) from test.t group by a,b,c;
+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+
| avg(a or 0) in (0,0) | avg(a or 0) in (1,1) | avg(b or 0) in (0,0) | avg(b or 0) in (1,1) | avg(c or 0) in (0,0) | avg(c or 0) in (1,1) |
+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+
|                    1 |                    0 |                    1 |                    0 |                    1 |                    0 |
|                    0 |                    1 |                    1 |                    0 |                    0 |                    1 |
|                    0 |                    1 |                    1 |                    0 |                 NULL |                 NULL |
|                    0 |                    1 |                    0 |                    1 |                    1 |                    0 |
|                    0 |                    1 |                    0 |                    1 |                    0 |                    1 |
|                    0 |                    1 |                    0 |                    1 |                 NULL |                 NULL |
|                    0 |                    1 |                    1 |                    0 |                    1 |                    0 |
|                    0 |                    1 |                    1 |                    0 |                    0 |                    1 |
|                    0 |                    1 |                    1 |                    0 |                 NULL |                 NULL |
|                    0 |                    1 |                    0 |                    1 |                    1 |                    0 |
|                    0 |                    1 |                    0 |                    1 |                    0 |                    1 |
|                    0 |                    1 |                    0 |                    1 |                 NULL |                 NULL |
+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+
mysql> set tidb_enforce_mpp=1; select avg(a and 0) in (0,0), avg(a and 0) in (1,1), avg(b and 0) in (0,0), avg(b and 0) in (1,1), avg(c and 0) in (0,0), avg(c and 0) in (1,1) from test.t group by a,b,c;
+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+
| avg(a and 0) in (0,0) | avg(a and 0) in (1,1) | avg(b and 0) in (0,0) | avg(b and 0) in (1,1) | avg(c and 0) in (0,0) | avg(c and 0) in (1,1) |
+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+
|                     1 |                     0 |                     1 |                     0 |                     1 |                     0 |
|                     1 |                     0 |                     1 |                     0 |                     1 |                     0 |
|                     1 |                     0 |                     1 |                     0 |                     1 |                     0 |
|                     1 |                     0 |                     1 |                     0 |                     1 |                     0 |
|                     1 |                     0 |                     1 |                     0 |                     1 |                     0 |
|                     1 |                     0 |                     1 |                     0 |                     1 |                     0 |
|                     1 |                     0 |                     1 |                     0 |                     1 |                     0 |
|                     1 |                     0 |                     1 |                     0 |                     1 |                     0 |
|                     1 |                     0 |                     1 |                     0 |                     1 |                     0 |
|                     1 |                     0 |                     1 |                     0 |                     1 |                     0 |
|                     1 |                     0 |                     1 |                     0 |                     1 |                     0 |
|                     1 |                     0 |                     1 |                     0 |                     1 |                     0 |
+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+
mysql> set tidb_enforce_mpp=1; select avg(a and 1) in (0,0), avg(a and 1) in (1,1), avg(b and 1) in (0,0), avg(b and 1) in (1,1), avg(c and 1) in (0,0), avg(c and 1) in (1,1) from test.t group by a,b,c;
+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+
| avg(a and 1) in (0,0) | avg(a and 1) in (1,1) | avg(b and 1) in (0,0) | avg(b and 1) in (1,1) | avg(c and 1) in (0,0) | avg(c and 1) in (1,1) |
+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+
|                     1 |                     0 |                     1 |                     0 |                     1 |                     0 |
|                     0 |                     1 |                     1 |                     0 |                     0 |                     1 |
|                     0 |                     1 |                     1 |                     0 |                  NULL |                  NULL |
|                     0 |                     1 |                     0 |                     1 |                     1 |                     0 |
|                     0 |                     1 |                     0 |                     1 |                     0 |                     1 |
|                     0 |                     1 |                     0 |                     1 |                  NULL |                  NULL |
|                     0 |                     1 |                     1 |                     0 |                     1 |                     0 |
|                     0 |                     1 |                     1 |                     0 |                     0 |                     1 |
|                     0 |                     1 |                     1 |                     0 |                  NULL |                  NULL |
|                     0 |                     1 |                     0 |                     1 |                     1 |                     0 |
|                     0 |                     1 |                     0 |                     1 |                     0 |                     1 |
|                     0 |                     1 |                     0 |                     1 |                  NULL |                  NULL |
+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+

mysql> set tidb_enforce_mpp=1; select (a or 1) in (0,0), (a or 1) in (1,1), (b or 1) in (0,0), (b or 1) in (1,1), (c or 1) in (0,0), (c or 1) in (1,1) from test.t;
+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+
| (a or 1) in (0,0) | (a or 1) in (1,1) | (b or 1) in (0,0) | (b or 1) in (1,1) | (c or 1) in (0,0) | (c or 1) in (1,1) |
+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+
|                 0 |                 1 |                 0 |                 1 |                 0 |                 1 |
|                 0 |                 1 |                 0 |                 1 |                 0 |                 1 |
|                 0 |                 1 |                 0 |                 1 |                 0 |                 1 |
|                 0 |                 1 |                 0 |                 1 |                 0 |                 1 |
|                 0 |                 1 |                 0 |                 1 |                 0 |                 1 |
|                 0 |                 1 |                 0 |                 1 |                 0 |                 1 |
|                 0 |                 1 |                 0 |                 1 |                 0 |                 1 |
|                 0 |                 1 |                 0 |                 1 |                 0 |                 1 |
|                 0 |                 1 |                 0 |                 1 |                 0 |                 1 |
|                 0 |                 1 |                 0 |                 1 |                 0 |                 1 |
|                 0 |                 1 |                 0 |                 1 |                 0 |                 1 |
|                 0 |                 1 |                 0 |                 1 |                 0 |                 1 |
+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+
mysql> set tidb_enforce_mpp=1; select (a or 0) in (0,0), (a or 0) in (1,1), (b or 0) in (0,0), (b or 0) in (1,1), (c or 0) in (0,0), (c or 0) in (1,1) from test.t;
+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+
| (a or 0) in (0,0) | (a or 0) in (1,1) | (b or 0) in (0,0) | (b or 0) in (1,1) | (c or 0) in (0,0) | (c or 0) in (1,1) |
+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+
|                 1 |                 0 |                 1 |                 0 |                 1 |                 0 |
|                 0 |                 1 |                 1 |                 0 |                 0 |                 1 |
|                 0 |                 1 |                 1 |                 0 |              NULL |              NULL |
|                 0 |                 1 |                 0 |                 1 |                 1 |                 0 |
|                 0 |                 1 |                 0 |                 1 |                 0 |                 1 |
|                 0 |                 1 |                 0 |                 1 |              NULL |              NULL |
|                 0 |                 1 |                 1 |                 0 |                 1 |                 0 |
|                 0 |                 1 |                 1 |                 0 |                 0 |                 1 |
|                 0 |                 1 |                 1 |                 0 |              NULL |              NULL |
|                 0 |                 1 |                 0 |                 1 |                 1 |                 0 |
|                 0 |                 1 |                 0 |                 1 |                 0 |                 1 |
|                 0 |                 1 |                 0 |                 1 |              NULL |              NULL |
+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+
mysql> set tidb_enforce_mpp=1; select (a and 0) in (0,0), (a and 0) in (1,1), (b and 0) in (0,0), (b and 0) in (1,1), (c and 0) in (0,0), (c and 0) in (1,1) from test.t;
+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+
| (a and 0) in (0,0) | (a and 0) in (1,1) | (b and 0) in (0,0) | (b and 0) in (1,1) | (c and 0) in (0,0) | (c and 0) in (1,1) |
+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+
|                  1 |                  0 |                  1 |                  0 |                  1 |                  0 |
|                  1 |                  0 |                  1 |                  0 |                  1 |                  0 |
|                  1 |                  0 |                  1 |                  0 |                  1 |                  0 |
|                  1 |                  0 |                  1 |                  0 |                  1 |                  0 |
|                  1 |                  0 |                  1 |                  0 |                  1 |                  0 |
|                  1 |                  0 |                  1 |                  0 |                  1 |                  0 |
|                  1 |                  0 |                  1 |                  0 |                  1 |                  0 |
|                  1 |                  0 |                  1 |                  0 |                  1 |                  0 |
|                  1 |                  0 |                  1 |                  0 |                  1 |                  0 |
|                  1 |                  0 |                  1 |                  0 |                  1 |                  0 |
|                  1 |                  0 |                  1 |                  0 |                  1 |                  0 |
|                  1 |                  0 |                  1 |                  0 |                  1 |                  0 |
+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+
mysql> set tidb_enforce_mpp=1; select (a and 1) in (0,0), (a and 1) in (1,1), (b and 1) in (0,0), (b and 1) in (1,1), (c and 1) in (0,0), (c and 1) in (1,1) from test.t;
+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+
| (a and 1) in (0,0) | (a and 1) in (1,1) | (b and 1) in (0,0) | (b and 1) in (1,1) | (c and 1) in (0,0) | (c and 1) in (1,1) |
+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+
|                  1 |                  0 |                  1 |                  0 |                  1 |                  0 |
|                  0 |                  1 |                  1 |                  0 |                  0 |                  1 |
|                  0 |                  1 |                  1 |                  0 |               NULL |               NULL |
|                  0 |                  1 |                  0 |                  1 |                  1 |                  0 |
|                  0 |                  1 |                  0 |                  1 |                  0 |                  1 |
|                  0 |                  1 |                  0 |                  1 |               NULL |               NULL |
|                  0 |                  1 |                  1 |                  0 |                  1 |                  0 |
|                  0 |                  1 |                  1 |                  0 |                  0 |                  1 |
|                  0 |                  1 |                  1 |                  0 |               NULL |               NULL |
|                  0 |                  1 |                  0 |                  1 |                  1 |                  0 |
|                  0 |                  1 |                  0 |                  1 |                  0 |                  1 |
|                  0 |                  1 |                  0 |                  1 |               NULL |               NULL |
+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+
