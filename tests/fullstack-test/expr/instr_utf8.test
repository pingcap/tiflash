# Copyright 2022 PingCAP, Ltd.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

mysql> drop table if exists test.t;
mysql> create table if not exists test.t(c1 varchar(64), c2 varchar(64)) CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

mysql> insert into test.t values('foobarbar', 'bar');
mysql> insert into test.t values('xbar', 'foobar');
mysql> insert into test.t values('中文美好', '美好');
mysql> insert into test.t values('中文美好', '世界');
mysql> insert into test.t values('中文abc', 'a');
mysql> insert into test.t values('live long and prosper', 'long');
mysql> insert into test.t values('not binary string', 'binary');
mysql> insert into test.t values('upper case', 'upper');
mysql> insert into test.t values('upper case', 'uPpEr');
mysql> insert into test.t values('UPPER CASE', 'CASE');
mysql> insert into test.t values('UPPER CASE', 'CasE');
mysql> insert into test.t values('中文abc', 'abc');
mysql> insert into test.t values('abcテストabc', 'テスト');
mysql> insert into test.t values('ѐёђѓєѕіїјљњћќѝўџ', 'ђѓєѕ');
mysql> insert into test.t values('foobar', NULL);
mysql> insert into test.t values(NULL, 'foobar');
mysql> insert into test.t values(NULL, NULL);
mysql> insert into test.t values('', NULL);
mysql> insert into test.t values('', '');
mysql> insert into test.t values('abc', '');
mysql> insert into test.t values('abc', NULL);
mysql> alter table test.t set tiflash replica 1;
func> wait_table test t

mysql> set tidb_enforce_mpp=1; set tidb_isolation_read_engines='tiflash'; select instr(c1,c2),c1,c2 from test.t ;
+--------------+----------------------------------+-----------+
| instr(c1,c2) | c1                               | c2        |
+--------------+----------------------------------+-----------+
|            4 | foobarbar                        | bar       |
|            0 | xbar                             | foobar    |
|            3 | 中文美好                         | 美好      |
|            0 | 中文美好                         | 世界      |
|            3 | 中文abc                          | a         |
|            6 | live long and prosper            | long      |
|            5 | not binary string                | binary    |
|            1 | upper case                       | upper     |
|            1 | upper case                       | uPpEr     |
|            7 | UPPER CASE                       | CASE      |
|            7 | UPPER CASE                       | CasE      |
|            3 | 中文abc                          | abc       |
|            4 | abcテストabc                     | テスト    |
|            3 | ѐёђѓєѕіїјљњћќѝўџ                 | ђѓєѕ      |
|         NULL | foobar                           | NULL      |
|         NULL | NULL                             | foobar    |
|         NULL | NULL                             | NULL      |
|         NULL |                                  | NULL      |
|            1 |                                  |           |
|            1 | abc                              |           |
|         NULL | abc                              | NULL      |
+--------------+----------------------------------+-----------+