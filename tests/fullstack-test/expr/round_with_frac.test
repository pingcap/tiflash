# Copyright 2023 PingCAP, Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

#mysql> drop table if exists test.i8
#mysql> create table test.i8 (id bigint, a tinyint)
#mysql> alter table test.i8 set tiflash replica 1
#mysql> insert into test.i8 values (1, 0), (2, 1), (3, -1), (4, 49), (5, 50), (6, -49), (7, -50), (8, 127), (9, -128), (10, null)

#mysql> drop table if exists test.u8
#mysql> create table test.u8 (id bigint, a tinyint unsigned)
#mysql> alter table test.u8 set tiflash replica 1
#mysql> insert into test.u8 values (1, 0), (2, 4), (3, 5), (4, 49), (5, 50), (6, 255), (7, null)

#mysql> drop table if exists test.i32
#mysql> create table test.i32 (id bigint, a int)
#mysql> alter table test.i32 set tiflash replica 1
#mysql> insert into test.i32 value (1, 0), (2, 4), (3, 5), (4, -4), (5, -5), (6, 499999999), (7, 500000000), (8, -499999999), (9, -500000000), (10, 2147483647), (11, -2147483648), (12, null)

#mysql> drop table if exists test.u32
#mysql> create table test.u32 (id bigint, a int unsigned)
#mysql> alter table test.u32 set tiflash replica 1
#mysql> insert into test.u32 value (1, 0), (2, 4), (3, 5), (4, 499999999), (5, 500000000), (6, 4294967295), (7, null)

#mysql> drop table if exists test.i64
#mysql> create table test.i64 (id bigint, a bigint)
#mysql> alter table test.i64 set tiflash replica 1
#mysql> insert into test.i64 values (1, 0), (2, 4), (3, 5), (4, -4), (5, -5), (6, 499999999999999999), (7, 500000000000000000), (8, -499999999999999999), (9, -500000000000000000), (10, null)

#mysql> drop table if exists test.u64
#mysql> create table test.u64 (id bigint, a bigint unsigned)
#mysql> alter table test.u64 set tiflash replica 1
#mysql> insert into test.u64 values (1, 0), (2, 4), (3, 5), (4, 4999999999999999999), (5, 5000000000000000000), (6, null)

mysql> drop table if exists test.f32
mysql> create table test.f32 (id bigint, a float)
mysql> alter table test.f32 set tiflash replica 1
mysql> insert into test.f32 values (1, 0), (2, 2.5), (3, -2.5), (4, 0.25), (5, -0.25), (6, 0.25e-10), (7, -0.25e-10), (8, 49e10), (9, 50e10), (10, -49e10), (11, -50e10), (12, 0.3), (13, null)

mysql> drop table if exists test.f64
mysql> create table test.f64 (id bigint, a double)
mysql> alter table test.f64 set tiflash replica 1
mysql> insert into test.f64 values (1, 0), (2, 2.5), (3, -2.5), (4, 0.25), (5, -0.25), (6, 0.25e-10), (7, -0.25e-10), (8, 49e10), (9, 50e10), (10, -49e10), (11, -50e10), (12, 0.3), (13, null)

mysql> drop table if exists test.d9
mysql> create table test.d9 (id bigint, a decimal(9, 4))
mysql> alter table test.d9 set tiflash replica 1
mysql> insert into test.d9 values (1, 0), (2, 0.25), (3, -0.25), (4, 0.0499), (5, 0.05), (6, -0.0499), (7, -0.05), (8, 49999.9999), (9, 50000), (10, -49999.9999), (11, -50000), (12, 99999.9999), (13, -99999.9999), (14, 25), (15, -25), (16, null)

mysql> drop table if exists test.d64
mysql> create table test.d64 (id bigint, a decimal(64, 2))
mysql> alter table test.d64 set tiflash replica 1
mysql> insert into test.d64 values (1, 0), (2, 0.25), (3, -0.25), (4, 25), (5, -25), (6, 49999999999999999999999999999999999999999999999999999999999999.99), (7, 50000000000000000000000000000000000000000000000000000000000000), (8, -49999999999999999999999999999999999999999999999999999999999999.99), (9, -50000000000000000000000000000000000000000000000000000000000000), (10, 0.49), (11, 0.5), (12, -0.49), (13, -0.5), (14, 99999999999999999999999999999999999999999999999999999999999999.99), (15, -99999999999999999999999999999999999999999999999999999999999999.99), (16, null)

mysql> drop table if exists test.t
mysql> create table test.t (i bigint)
mysql> alter table test.t set tiflash replica 1
mysql> insert into test.t values (-66), (-65), (-64), (-63), (-62), (-61), (-60), (-59), (-58), (-57), (-56), (-55), (-54), (-53), (-52), (-51), (-50), (-49), (-48), (-47), (-46), (-45), (-44), (-43), (-42), (-41), (-40), (-39), (-38), (-37), (-36), (-35), (-34), (-33), (-32), (-31), (-30), (-29), (-28), (-27), (-26), (-25), (-24), (-23), (-22), (-21), (-20), (-19), (-18), (-17), (-16), (-15), (-14), (-13), (-12), (-11), (-10), (-9), (-8), (-7), (-6), (-5), (-4), (-3), (-2), (-1), (0), (1), (2), (3), (4), (5), (6), (7), (8), (9), (10), (11), (12), (13), (14), (15), (16), (17), (18), (19), (20), (21), (22), (23), (24), (25), (26), (27), (28), (29), (30), (31), (9223372036854775807), (-9223372036854775808)

# TODO: wait for TiDB integer round fix.
#func> wait_table test i8 u8 i32 u32 i64 u64
func> wait_table test f32 f64 d9 d64 t

# const frac

#mysql> set tidb_enforce_mpp=1; select sum(a), sum(round(a, 1)), sum(round(a, 0)), sum(round(a, -1)), sum(round(a, -2)), sum(round(a, -3)), sum(round(a, -4)) from test.i8 group by id order by id
#+--------+------------------+------------------+-------------------+-------------------+-------------------+-------------------+
#| sum(a) | sum(round(a, 1)) | sum(round(a, 0)) | sum(round(a, -1)) | sum(round(a, -2)) | sum(round(a, -3)) | sum(round(a, -4)) |
#+--------+------------------+------------------+-------------------+-------------------+-------------------+-------------------+
#|      0 |                0 |                0 |                 0 |                 0 |                 0 |                 0 |
#|      1 |                1 |                1 |                 0 |                 0 |                 0 |                 0 |
#|     -1 |               -1 |               -1 |                 0 |                 0 |                 0 |                 0 |
#|     49 |               49 |               49 |                50 |                 0 |                 0 |                 0 |
#|     50 |               50 |               50 |                50 |               100 |                 0 |                 0 |
#|    -49 |              -49 |              -49 |               -50 |                 0 |                 0 |                 0 |
#|    -50 |              -50 |              -50 |               -50 |              -100 |                 0 |                 0 |
#|    127 |              127 |              127 |               130 |               100 |                 0 |                 0 |
#|   -128 |             -128 |             -128 |              -130 |              -100 |                 0 |                 0 |
#|   NULL |             NULL |             NULL |              NULL |              NULL |              NULL |              NULL |
#+--------+------------------+------------------+-------------------+-------------------+-------------------+-------------------+

#mysql> set tidb_enforce_mpp=1; select sum(a), sum(round(a, 1)), sum(round(a, 0)), sum(round(a, -1)), sum(round(a, -2)), sum(round(a, -3)), sum(round(a, -4)) from test.u8 group by id order by id
#+--------+------------------+------------------+-------------------+-------------------+-------------------+-------------------+
#| sum(a) | sum(round(a, 1)) | sum(round(a, 0)) | sum(round(a, -1)) | sum(round(a, -2)) | sum(round(a, -3)) | sum(round(a, -4)) |
#+--------+------------------+------------------+-------------------+-------------------+-------------------+-------------------+
#|      0 |                0 |                0 |                 0 |                 0 |                 0 |                 0 |
#|      4 |                4 |                4 |                 0 |                 0 |                 0 |                 0 |
#|      5 |                5 |                5 |                10 |                 0 |                 0 |                 0 |
#|     49 |               49 |               49 |                50 |                 0 |                 0 |                 0 |
#|     50 |               50 |               50 |                50 |               100 |                 0 |                 0 |
#|    255 |              255 |              255 |               260 |               300 |                 0 |                 0 |
#|   NULL |             NULL |             NULL |              NULL |              NULL |              NULL |              NULL |
#+--------+------------------+------------------+-------------------+-------------------+-------------------+-------------------+

#mysql> set tidb_enforce_mpp=1; select sum(a), sum(round(a, 1)), sum(round(a, 0)), sum(round(a, -1)), sum(round(a, -2)), sum(round(a, -8)), sum(round(a, -9)), sum(round(a, -10)) from test.i32 group by id order by id
#+-------------+------------------+------------------+-------------------+-------------------+-------------------+-------------------+--------------------+
#| sum(a)      | sum(round(a, 1)) | sum(round(a, 0)) | sum(round(a, -1)) | sum(round(a, -2)) | sum(round(a, -8)) | sum(round(a, -9)) | sum(round(a, -10)) |
#+-------------+------------------+------------------+-------------------+-------------------+-------------------+-------------------+--------------------+
#|           0 |                0 |                0 |                 0 |                 0 |                 0 |                 0 |                  0 |
#|           4 |                4 |                4 |                 0 |                 0 |                 0 |                 0 |                  0 |
#|           5 |                5 |                5 |                10 |                 0 |                 0 |                 0 |                  0 |
#|          -4 |               -4 |               -4 |                 0 |                 0 |                 0 |                 0 |                  0 |
#|          -5 |               -5 |               -5 |               -10 |                 0 |                 0 |                 0 |                  0 |
#|   499999999 |        499999999 |        499999999 |         500000000 |         500000000 |         500000000 |                 0 |                  0 |
#|   500000000 |        500000000 |        500000000 |         500000000 |         500000000 |         500000000 |        1000000000 |                  0 |
#|  -499999999 |       -499999999 |       -499999999 |        -500000000 |        -500000000 |        -500000000 |                 0 |                  0 |
#|  -500000000 |       -500000000 |       -500000000 |        -500000000 |        -500000000 |        -500000000 |       -1000000000 |                  0 |
#|  2147483647 |       2147483647 |       2147483647 |        2147483650 |        2147483600 |        2100000000 |        2000000000 |                  0 |
#| -2147483648 |      -2147483648 |      -2147483648 |       -2147483650 |       -2147483600 |       -2100000000 |       -2000000000 |                  0 |
#|        NULL |             NULL |             NULL |              NULL |              NULL |              NULL |              NULL |               NULL |
#+-------------+------------------+------------------+-------------------+-------------------+-------------------+-------------------+--------------------+

#mysql> set tidb_enforce_mpp=1; select sum(a), sum(round(a, 1)), sum(round(a, 0)), sum(round(a, -1)), sum(round(a, -2)), sum(round(a, -8)), sum(round(a, -9)), sum(round(a, -10)) from test.u32 group by id order by id
#+------------+------------------+------------------+-------------------+-------------------+-------------------+-------------------+--------------------+
#| sum(a)     | sum(round(a, 1)) | sum(round(a, 0)) | sum(round(a, -1)) | sum(round(a, -2)) | sum(round(a, -8)) | sum(round(a, -9)) | sum(round(a, -10)) |
#+------------+------------------+------------------+-------------------+-------------------+-------------------+-------------------+--------------------+
#|          0 |                0 |                0 |                 0 |                 0 |                 0 |                 0 |                  0 |
#|          4 |                4 |                4 |                 0 |                 0 |                 0 |                 0 |                  0 |
#|          5 |                5 |                5 |                10 |                 0 |                 0 |                 0 |                  0 |
#|  499999999 |        499999999 |        499999999 |         500000000 |         500000000 |         500000000 |                 0 |                  0 |
#|  500000000 |        500000000 |        500000000 |         500000000 |         500000000 |         500000000 |        1000000000 |                  0 |
#| 4294967295 |       4294967295 |       4294967295 |        4294967300 |        4294967300 |        4300000000 |        4000000000 |                  0 |
#|       NULL |             NULL |             NULL |              NULL |              NULL |              NULL |              NULL |               NULL |
#+------------+------------------+------------------+-------------------+-------------------+-------------------+-------------------+--------------------+

#mysql> set tidb_enforce_mpp=1; select sum(a), sum(round(a, 1)), sum(round(a, 0)), sum(round(a, -1)), sum(round(a, -2)), sum(round(a, -18)), sum(round(a, -19)), sum(round(a, -20)) from test.i64 group by id order by id
#+---------------------+---------------------+---------------------+---------------------+---------------------+----------------------+--------------------+--------------------+
#| sum(a)              | sum(round(a, 1))    | sum(round(a, 0))    | sum(round(a, -1))   | sum(round(a, -2))   | sum(round(a, -18))   | sum(round(a, -19)) | sum(round(a, -20)) |
#+---------------------+---------------------+---------------------+---------------------+---------------------+----------------------+--------------------+--------------------+
#|                   0 |                   0 |                   0 |                   0 |                   0 |                    0 |                  0 |                  0 |
#|                   4 |                   4 |                   4 |                   0 |                   0 |                    0 |                  0 |                  0 |
#|                   5 |                   5 |                   5 |                  10 |                   0 |                    0 |                  0 |                  0 |
#|                  -4 |                  -4 |                  -4 |                   0 |                   0 |                    0 |                  0 |                  0 |
#|                  -5 |                  -5 |                  -5 |                 -10 |                   0 |                    0 |                  0 |                  0 |
#|  499999999999999999 |  499999999999999999 |  499999999999999999 |  500000000000000000 |  500000000000000000 |                    0 |                  0 |                  0 |
#|  500000000000000000 |  500000000000000000 |  500000000000000000 |  500000000000000000 |  500000000000000000 |  1000000000000000000 |                  0 |                  0 |
#| -499999999999999999 | -499999999999999999 | -499999999999999999 | -500000000000000000 | -500000000000000000 |                    0 |                  0 |                  0 |
#| -500000000000000000 | -500000000000000000 | -500000000000000000 | -500000000000000000 | -500000000000000000 | -1000000000000000000 |                  0 |                  0 |
#|                NULL |                NULL |                NULL |                NULL |                NULL |                 NULL |               NULL |               NULL |
#+---------------------+---------------------+---------------------+---------------------+---------------------+----------------------+--------------------+--------------------+

#mysql> set tidb_enforce_mpp=1; select sum(a), sum(round(a, 1)), sum(round(a, 0)), sum(round(a, -1)), sum(round(a, -2)), sum(round(a, -16)), sum(round(a, -18)), sum(round(a, -19)), sum(round(a, -20)) from test.u64 group by id order by id
#+---------------------+---------------------+---------------------+---------------------+---------------------+---------------------+---------------------+----------------------+--------------------+
#| sum(a)              | sum(round(a, 1))    | sum(round(a, 0))    | sum(round(a, -1))   | sum(round(a, -2))   | sum(round(a, -16))  | sum(round(a, -18))  | sum(round(a, -19))   | sum(round(a, -20)) |
#+---------------------+---------------------+---------------------+---------------------+---------------------+---------------------+---------------------+----------------------+--------------------+
#|                   0 |                   0 |                   0 |                   0 |                   0 |                   0 |                   0 |                    0 |                  0 |
#|                   4 |                   4 |                   4 |                   0 |                   0 |                   0 |                   0 |                    0 |                  0 |
#|                   5 |                   5 |                   5 |                  10 |                   0 |                   0 |                   0 |                    0 |                  0 |
#| 4999999999999999999 | 4999999999999999999 | 4999999999999999999 | 5000000000000000000 | 5000000000000000000 | 5000000000000000000 | 5000000000000000000 |                    0 |                  0 |
#| 5000000000000000000 | 5000000000000000000 | 5000000000000000000 | 5000000000000000000 | 5000000000000000000 | 5000000000000000000 | 5000000000000000000 | 10000000000000000000 |                  0 |
#|                NULL |                NULL |                NULL |                NULL |                NULL |                NULL |                NULL |                 NULL |               NULL |
#+---------------------+---------------------+---------------------+---------------------+---------------------+---------------------+---------------------+----------------------+--------------------+

mysql> set tidb_enforce_mpp=1; select sum(a), sum(round(a, 2)), sum(round(a, 1)), sum(round(a, 0)), sum(round(a, -1)), sum(round(a, -2)) from test.f32 group by id order by id
+------------------------------+------------------+------------------+------------------+-------------------+-------------------+
| sum(a)                       | sum(round(a, 2)) | sum(round(a, 1)) | sum(round(a, 0)) | sum(round(a, -1)) | sum(round(a, -2)) |
+------------------------------+------------------+------------------+------------------+-------------------+-------------------+
|                            0 |                0 |                0 |                0 |                 0 |                 0 |
|                          2.5 |              2.5 |              2.5 |                2 |                 0 |                 0 |
|                         -2.5 |             -2.5 |             -2.5 |               -2 |                 0 |                 0 |
|                         0.25 |             0.25 |              0.2 |                0 |                 0 |                 0 |
|                        -0.25 |            -0.25 |             -0.2 |                0 |                 0 |                 0 |
|  0.0000000000250000003337858 |                0 |                0 |                0 |                 0 |                 0 |
| -0.0000000000250000003337858 |                0 |                0 |                0 |                 0 |                 0 |
|                 489999990784 |     489999990784 |     489999990784 |     489999990784 |      489999990780 |      489999990800 |
|                 499999997952 |     499999997952 |     499999997952 |     499999997952 |      499999997950 |      499999998000 |
|                -489999990784 |    -489999990784 |    -489999990784 |    -489999990784 |     -489999990780 |     -489999990800 |
|                -499999997952 |    -499999997952 |    -499999997952 |    -499999997952 |     -499999997950 |     -499999998000 |
|          0.30000001192092896 |              0.3 |              0.3 |                0 |                 0 |                 0 |
|                         NULL |             NULL |             NULL |             NULL |              NULL |              NULL |
+------------------------------+------------------+------------------+------------------+-------------------+-------------------+

mysql> set tidb_enforce_mpp=1; select sum(a), sum(round(a, 8)), sum(round(a, 9)), sum(round(a, -9)), sum(round(a, -10)) from test.f32 group by id order by id
+------------------------------+------------------+------------------+---------------------+--------------------+
| sum(a)                       | sum(round(a, 8)) | sum(round(a, 9)) | sum(round(a, -9))   | sum(round(a, -10)) |
+------------------------------+------------------+------------------+---------------------+--------------------+
|                            0 |                0 |                0 |                   0 |                  0 |
|                          2.5 |              2.5 |              2.5 |                   0 |                  0 |
|                         -2.5 |             -2.5 |             -2.5 |                   0 |                  0 |
|                         0.25 |             0.25 |             0.25 |                   0 |                  0 |
|                        -0.25 |            -0.25 |            -0.25 |                   0 |                  0 |
|  0.0000000000250000003337858 |                0 |                0 |                   0 |                  0 |
| -0.0000000000250000003337858 |                0 |                0 |                   0 |                  0 |
|                 489999990784 |     489999990784 |     489999990784 |  489999999999.99994 |       490000000000 |
|                 499999997952 |     499999997952 |     499999997952 |  499999999999.99994 |       500000000000 |
|                -489999990784 |    -489999990784 |    -489999990784 | -489999999999.99994 |      -490000000000 |
|                -499999997952 |    -499999997952 |    -499999997952 | -499999999999.99994 |      -500000000000 |
|          0.30000001192092896 |       0.30000001 |      0.300000012 |                   0 |                  0 |
|                         NULL |             NULL |             NULL |                NULL |               NULL |
+------------------------------+------------------+------------------+---------------------+--------------------+

mysql> set tidb_enforce_mpp=1; select sum(a), sum(round(a, 30)), sum(round(a, -30)), sum(round(a, 1000000)), sum(round(a, -1000000)) from test.f32 group by id order by id
+------------------------------+------------------------------+--------------------+------------------------------+-------------------------+
| sum(a)                       | sum(round(a, 30))            | sum(round(a, -30)) | sum(round(a, 1000000))       | sum(round(a, -1000000)) |
+------------------------------+------------------------------+--------------------+------------------------------+-------------------------+
|                            0 |                            0 |                  0 |                            0 |                       0 |
|                          2.5 |                          2.5 |                  0 |                          2.5 |                       0 |
|                         -2.5 |                         -2.5 |                  0 |                         -2.5 |                       0 |
|                         0.25 |                         0.25 |                  0 |                         0.25 |                       0 |
|                        -0.25 |                        -0.25 |                  0 |                        -0.25 |                       0 |
|  0.0000000000250000003337858 |  0.0000000000250000003337858 |                  0 |  0.0000000000250000003337858 |                       0 |
| -0.0000000000250000003337858 | -0.0000000000250000003337858 |                  0 | -0.0000000000250000003337858 |                       0 |
|                 489999990784 |                 489999990784 |                  0 |                 489999990784 |                       0 |
|                 499999997952 |                 499999997952 |                  0 |                 499999997952 |                       0 |
|                -489999990784 |                -489999990784 |                  0 |                -489999990784 |                       0 |
|                -499999997952 |                -499999997952 |                  0 |                -499999997952 |                       0 |
|          0.30000001192092896 |          0.30000001192092896 |                  0 |          0.30000001192092896 |                       0 |
|                         NULL |                         NULL |               NULL |                         NULL |                    NULL |
+------------------------------+------------------------------+--------------------+------------------------------+-------------------------+

mysql> set tidb_enforce_mpp=1; select sum(a), sum(round(a, 2)), sum(round(a, 1)), sum(round(a, 0)), sum(round(a, -1)), sum(round(a, -2)) from test.f64 group by id order by id
+-----------------+------------------+------------------+------------------+-------------------+-------------------+
| sum(a)          | sum(round(a, 2)) | sum(round(a, 1)) | sum(round(a, 0)) | sum(round(a, -1)) | sum(round(a, -2)) |
+-----------------+------------------+------------------+------------------+-------------------+-------------------+
|               0 |                0 |                0 |                0 |                 0 |                 0 |
|             2.5 |              2.5 |              2.5 |                2 |                 0 |                 0 |
|            -2.5 |             -2.5 |             -2.5 |               -2 |                 0 |                 0 |
|            0.25 |             0.25 |              0.2 |                0 |                 0 |                 0 |
|           -0.25 |            -0.25 |             -0.2 |                0 |                 0 |                 0 |
|  0.000000000025 |                0 |                0 |                0 |                 0 |                 0 |
| -0.000000000025 |                0 |                0 |                0 |                 0 |                 0 |
|    490000000000 |     490000000000 |     490000000000 |     490000000000 |      490000000000 |      490000000000 |
|    500000000000 |     500000000000 |     500000000000 |     500000000000 |      500000000000 |      500000000000 |
|   -490000000000 |    -490000000000 |    -490000000000 |    -490000000000 |     -490000000000 |     -490000000000 |
|   -500000000000 |    -500000000000 |    -500000000000 |    -500000000000 |     -500000000000 |     -500000000000 |
|             0.3 |              0.3 |              0.3 |                0 |                 0 |                 0 |
|            NULL |             NULL |             NULL |             NULL |              NULL |              NULL |
+-----------------+------------------+------------------+------------------+-------------------+-------------------+

mysql> set tidb_enforce_mpp=1; select sum(a), sum(round(a, 8)), sum(round(a, 9)), sum(round(a, -9)), sum(round(a, -10)) from test.f64 group by id order by id
+-----------------+------------------+------------------+---------------------+--------------------+
| sum(a)          | sum(round(a, 8)) | sum(round(a, 9)) | sum(round(a, -9))   | sum(round(a, -10)) |
+-----------------+------------------+------------------+---------------------+--------------------+
|               0 |                0 |                0 |                   0 |                  0 |
|             2.5 |              2.5 |              2.5 |                   0 |                  0 |
|            -2.5 |             -2.5 |             -2.5 |                   0 |                  0 |
|            0.25 |             0.25 |             0.25 |                   0 |                  0 |
|           -0.25 |            -0.25 |            -0.25 |                   0 |                  0 |
|  0.000000000025 |                0 |                0 |                   0 |                  0 |
| -0.000000000025 |                0 |                0 |                   0 |                  0 |
|    490000000000 |     490000000000 |     490000000000 |  489999999999.99994 |       490000000000 |
|    500000000000 |     500000000000 |     500000000000 |  499999999999.99994 |       500000000000 |
|   -490000000000 |    -490000000000 |    -490000000000 | -489999999999.99994 |      -490000000000 |
|   -500000000000 |    -500000000000 |    -500000000000 | -499999999999.99994 |      -500000000000 |
|             0.3 |              0.3 |              0.3 |                   0 |                  0 |
|            NULL |             NULL |             NULL |                NULL |               NULL |
+-----------------+------------------+------------------+---------------------+--------------------+

mysql> set tidb_enforce_mpp=1; select sum(a), sum(round(a, 30)), sum(round(a, -30)), sum(round(a, 1000000)), sum(round(a, -1000000)) from test.f64 group by id order by id
+-----------------+-------------------+--------------------+------------------------+-------------------------+
| sum(a)          | sum(round(a, 30)) | sum(round(a, -30)) | sum(round(a, 1000000)) | sum(round(a, -1000000)) |
+-----------------+-------------------+--------------------+------------------------+-------------------------+
|               0 |                 0 |                  0 |                      0 |                       0 |
|             2.5 |               2.5 |                  0 |                    2.5 |                       0 |
|            -2.5 |              -2.5 |                  0 |                   -2.5 |                       0 |
|            0.25 |              0.25 |                  0 |                   0.25 |                       0 |
|           -0.25 |             -0.25 |                  0 |                  -0.25 |                       0 |
|  0.000000000025 |    0.000000000025 |                  0 |         0.000000000025 |                       0 |
| -0.000000000025 |   -0.000000000025 |                  0 |        -0.000000000025 |                       0 |
|    490000000000 |      490000000000 |                  0 |           490000000000 |                       0 |
|    500000000000 |      500000000000 |                  0 |           500000000000 |                       0 |
|   -490000000000 |     -490000000000 |                  0 |          -490000000000 |                       0 |
|   -500000000000 |     -500000000000 |                  0 |          -500000000000 |                       0 |
|             0.3 |               0.3 |                  0 |                    0.3 |                       0 |
|            NULL |              NULL |               NULL |                   NULL |                    NULL |
+-----------------+-------------------+--------------------+------------------------+-------------------------+

mysql> set tidb_enforce_mpp=1; select sum(a), sum(round(a, -1)), sum(round(a, 0)), sum(round(a, 1)) from test.d9 group by id order by id
+-------------+-------------------+------------------+------------------+
| sum(a)      | sum(round(a, -1)) | sum(round(a, 0)) | sum(round(a, 1)) |
+-------------+-------------------+------------------+------------------+
|      0.0000 |                 0 |                0 |              0.0 |
|      0.2500 |                 0 |                0 |              0.3 |
|     -0.2500 |                 0 |                0 |             -0.3 |
|      0.0499 |                 0 |                0 |              0.0 |
|      0.0500 |                 0 |                0 |              0.1 |
|     -0.0499 |                 0 |                0 |              0.0 |
|     -0.0500 |                 0 |                0 |             -0.1 |
|  49999.9999 |             50000 |            50000 |          50000.0 |
|  50000.0000 |             50000 |            50000 |          50000.0 |
| -49999.9999 |            -50000 |           -50000 |         -50000.0 |
| -50000.0000 |            -50000 |           -50000 |         -50000.0 |
|  99999.9999 |            100000 |           100000 |         100000.0 |
| -99999.9999 |           -100000 |          -100000 |        -100000.0 |
|     25.0000 |                30 |               25 |             25.0 |
|    -25.0000 |               -30 |              -25 |            -25.0 |
|        NULL |              NULL |             NULL |             NULL |
+-------------+-------------------+------------------+------------------+

mysql> set tidb_enforce_mpp=1; select sum(a), sum(round(a, 3)), sum(round(a, 4)), sum(round(a, 5)), sum(round(a, 40)) from test.d9 group by id order by id
+-------------+------------------+------------------+------------------+---------------------------------------+
| sum(a)      | sum(round(a, 3)) | sum(round(a, 4)) | sum(round(a, 5)) | sum(round(a, 40))                     |
+-------------+------------------+------------------+------------------+---------------------------------------+
|      0.0000 |            0.000 |           0.0000 |          0.00000 |      0.000000000000000000000000000000 |
|      0.2500 |            0.250 |           0.2500 |          0.25000 |      0.250000000000000000000000000000 |
|     -0.2500 |           -0.250 |          -0.2500 |         -0.25000 |     -0.250000000000000000000000000000 |
|      0.0499 |            0.050 |           0.0499 |          0.04990 |      0.049900000000000000000000000000 |
|      0.0500 |            0.050 |           0.0500 |          0.05000 |      0.050000000000000000000000000000 |
|     -0.0499 |           -0.050 |          -0.0499 |         -0.04990 |     -0.049900000000000000000000000000 |
|     -0.0500 |           -0.050 |          -0.0500 |         -0.05000 |     -0.050000000000000000000000000000 |
|  49999.9999 |        50000.000 |       49999.9999 |      49999.99990 |  49999.999900000000000000000000000000 |
|  50000.0000 |        50000.000 |       50000.0000 |      50000.00000 |  50000.000000000000000000000000000000 |
| -49999.9999 |       -50000.000 |      -49999.9999 |     -49999.99990 | -49999.999900000000000000000000000000 |
| -50000.0000 |       -50000.000 |      -50000.0000 |     -50000.00000 | -50000.000000000000000000000000000000 |
|  99999.9999 |       100000.000 |       99999.9999 |      99999.99990 |  99999.999900000000000000000000000000 |
| -99999.9999 |      -100000.000 |      -99999.9999 |     -99999.99990 | -99999.999900000000000000000000000000 |
|     25.0000 |           25.000 |          25.0000 |         25.00000 |     25.000000000000000000000000000000 |
|    -25.0000 |          -25.000 |         -25.0000 |        -25.00000 |    -25.000000000000000000000000000000 |
|        NULL |             NULL |             NULL |             NULL |                                  NULL |
+-------------+------------------+------------------+------------------+---------------------------------------+

mysql> set tidb_enforce_mpp=1; select sum(a), sum(round(a, -4)), sum(round(a, -5)), sum(round(a, -6)), sum(round(a, -100)) from test.d9 group by id order by id
+-------------+-------------------+-------------------+-------------------+---------------------+
| sum(a)      | sum(round(a, -4)) | sum(round(a, -5)) | sum(round(a, -6)) | sum(round(a, -100)) |
+-------------+-------------------+-------------------+-------------------+---------------------+
|      0.0000 |                 0 |                 0 |                 0 |                   0 |
|      0.2500 |                 0 |                 0 |                 0 |                   0 |
|     -0.2500 |                 0 |                 0 |                 0 |                   0 |
|      0.0499 |                 0 |                 0 |                 0 |                   0 |
|      0.0500 |                 0 |                 0 |                 0 |                   0 |
|     -0.0499 |                 0 |                 0 |                 0 |                   0 |
|     -0.0500 |                 0 |                 0 |                 0 |                   0 |
|  49999.9999 |             50000 |                 0 |                 0 |                   0 |
|  50000.0000 |             50000 |            100000 |                 0 |                   0 |
| -49999.9999 |            -50000 |                 0 |                 0 |                   0 |
| -50000.0000 |            -50000 |           -100000 |                 0 |                   0 |
|  99999.9999 |            100000 |            100000 |                 0 |                   0 |
| -99999.9999 |           -100000 |           -100000 |                 0 |                   0 |
|     25.0000 |                 0 |                 0 |                 0 |                   0 |
|    -25.0000 |                 0 |                 0 |                 0 |                   0 |
|        NULL |              NULL |              NULL |              NULL |                NULL |
+-------------+-------------------+-------------------+-------------------+---------------------+

mysql> set tidb_enforce_mpp=1; select sum(a), sum(round(a, -1)), sum(round(a, 0)), sum(round(a, 1)) from test.d64 group by id order by id
+--------------------------------------------------------------------+------------------------------------------------------------------+------------------------------------------------------------------+--------------------------------------------------------------------+
| sum(a)                                                             | sum(round(a, -1))                                                | sum(round(a, 0))                                                 | sum(round(a, 1))                                                   |
+--------------------------------------------------------------------+------------------------------------------------------------------+------------------------------------------------------------------+--------------------------------------------------------------------+
|                                                               0.00 |                                                                0 |                                                                0 |                                                                0.0 |
|                                                               0.25 |                                                                0 |                                                                0 |                                                                0.3 |
|                                                              -0.25 |                                                                0 |                                                                0 |                                                               -0.3 |
|                                                              25.00 |                                                               30 |                                                               25 |                                                               25.0 |
|                                                             -25.00 |                                                              -30 |                                                              -25 |                                                              -25.0 |
|  49999999999999999999999999999999999999999999999999999999999999.99 |   50000000000000000000000000000000000000000000000000000000000000 |   50000000000000000000000000000000000000000000000000000000000000 |   50000000000000000000000000000000000000000000000000000000000000.0 |
|  50000000000000000000000000000000000000000000000000000000000000.00 |   50000000000000000000000000000000000000000000000000000000000000 |   50000000000000000000000000000000000000000000000000000000000000 |   50000000000000000000000000000000000000000000000000000000000000.0 |
| -49999999999999999999999999999999999999999999999999999999999999.99 |  -50000000000000000000000000000000000000000000000000000000000000 |  -50000000000000000000000000000000000000000000000000000000000000 |  -50000000000000000000000000000000000000000000000000000000000000.0 |
| -50000000000000000000000000000000000000000000000000000000000000.00 |  -50000000000000000000000000000000000000000000000000000000000000 |  -50000000000000000000000000000000000000000000000000000000000000 |  -50000000000000000000000000000000000000000000000000000000000000.0 |
|                                                               0.49 |                                                                0 |                                                                0 |                                                                0.5 |
|                                                               0.50 |                                                                0 |                                                                1 |                                                                0.5 |
|                                                              -0.49 |                                                                0 |                                                                0 |                                                               -0.5 |
|                                                              -0.50 |                                                                0 |                                                               -1 |                                                               -0.5 |
|  99999999999999999999999999999999999999999999999999999999999999.99 |  100000000000000000000000000000000000000000000000000000000000000 |  100000000000000000000000000000000000000000000000000000000000000 |  100000000000000000000000000000000000000000000000000000000000000.0 |
| -99999999999999999999999999999999999999999999999999999999999999.99 | -100000000000000000000000000000000000000000000000000000000000000 | -100000000000000000000000000000000000000000000000000000000000000 | -100000000000000000000000000000000000000000000000000000000000000.0 |
|                                                               NULL |                                                             NULL |                                                             NULL |                                                               NULL |
+--------------------------------------------------------------------+------------------------------------------------------------------+------------------------------------------------------------------+--------------------------------------------------------------------+

mysql> set tidb_enforce_mpp=1; select sum(a), sum(round(a, 2)), sum(round(a, -61)), sum(round(a, -62)) from test.d64 group by id order by id
+--------------------------------------------------------------------+--------------------------------------------------------------------+------------------------------------------------------------------+------------------------------------------------------------------+
| sum(a)                                                             | sum(round(a, 2))                                                   | sum(round(a, -61))                                               | sum(round(a, -62))                                               |
+--------------------------------------------------------------------+--------------------------------------------------------------------+------------------------------------------------------------------+------------------------------------------------------------------+
|                                                               0.00 |                                                               0.00 |                                                                0 |                                                                0 |
|                                                               0.25 |                                                               0.25 |                                                                0 |                                                                0 |
|                                                              -0.25 |                                                              -0.25 |                                                                0 |                                                                0 |
|                                                              25.00 |                                                              25.00 |                                                                0 |                                                                0 |
|                                                             -25.00 |                                                             -25.00 |                                                                0 |                                                                0 |
|  49999999999999999999999999999999999999999999999999999999999999.99 |  49999999999999999999999999999999999999999999999999999999999999.99 |   50000000000000000000000000000000000000000000000000000000000000 |                                                                0 |
|  50000000000000000000000000000000000000000000000000000000000000.00 |  50000000000000000000000000000000000000000000000000000000000000.00 |   50000000000000000000000000000000000000000000000000000000000000 |  100000000000000000000000000000000000000000000000000000000000000 |
| -49999999999999999999999999999999999999999999999999999999999999.99 | -49999999999999999999999999999999999999999999999999999999999999.99 |  -50000000000000000000000000000000000000000000000000000000000000 |                                                                0 |
| -50000000000000000000000000000000000000000000000000000000000000.00 | -50000000000000000000000000000000000000000000000000000000000000.00 |  -50000000000000000000000000000000000000000000000000000000000000 | -100000000000000000000000000000000000000000000000000000000000000 |
|                                                               0.49 |                                                               0.49 |                                                                0 |                                                                0 |
|                                                               0.50 |                                                               0.50 |                                                                0 |                                                                0 |
|                                                              -0.49 |                                                              -0.49 |                                                                0 |                                                                0 |
|                                                              -0.50 |                                                              -0.50 |                                                                0 |                                                                0 |
|  99999999999999999999999999999999999999999999999999999999999999.99 |  99999999999999999999999999999999999999999999999999999999999999.99 |  100000000000000000000000000000000000000000000000000000000000000 |  100000000000000000000000000000000000000000000000000000000000000 |
| -99999999999999999999999999999999999999999999999999999999999999.99 | -99999999999999999999999999999999999999999999999999999999999999.99 | -100000000000000000000000000000000000000000000000000000000000000 | -100000000000000000000000000000000000000000000000000000000000000 |
|                                                               NULL |                                                               NULL |                                                             NULL |                                                             NULL |
+--------------------------------------------------------------------+--------------------------------------------------------------------+------------------------------------------------------------------+------------------------------------------------------------------+

mysql> set tidb_enforce_mpp=1; select sum(a), sum(round(a, -63)), sum(round(a, -100)) from test.d64 group by id order by id
+--------------------------------------------------------------------+--------------------+---------------------+
| sum(a)                                                             | sum(round(a, -63)) | sum(round(a, -100)) |
+--------------------------------------------------------------------+--------------------+---------------------+
|                                                               0.00 |                  0 |                   0 |
|                                                               0.25 |                  0 |                   0 |
|                                                              -0.25 |                  0 |                   0 |
|                                                              25.00 |                  0 |                   0 |
|                                                             -25.00 |                  0 |                   0 |
|  49999999999999999999999999999999999999999999999999999999999999.99 |                  0 |                   0 |
|  50000000000000000000000000000000000000000000000000000000000000.00 |                  0 |                   0 |
| -49999999999999999999999999999999999999999999999999999999999999.99 |                  0 |                   0 |
| -50000000000000000000000000000000000000000000000000000000000000.00 |                  0 |                   0 |
|                                                               0.49 |                  0 |                   0 |
|                                                               0.50 |                  0 |                   0 |
|                                                              -0.49 |                  0 |                   0 |
|                                                              -0.50 |                  0 |                   0 |
|  99999999999999999999999999999999999999999999999999999999999999.99 |                  0 |                   0 |
| -99999999999999999999999999999999999999999999999999999999999999.99 |                  0 |                   0 |
|                                                               NULL |               NULL |                NULL |
+--------------------------------------------------------------------+--------------------+---------------------+

# const input, variable frac

mysql> set tidb_enforce_mpp=1; select sum(round(null, i)) from test.t
+---------------------+
| sum(round(null, i)) |
+---------------------+
|                NULL |
+---------------------+

#mysql> set tidb_enforce_mpp=1; select sum(round(-123456789123456789, i)) from test.t
#+------------------------------------+
#| sum(round(-123456789123456789, i)) |
#+------------------------------------+
#|               -6145515733034404627 |
#+------------------------------------+

mysql> set tidb_enforce_mpp=1; select sum(round(123456789123456789.123456789123456789, i)) from test.t
+------------------------------------------------------+
| sum(round(123456789123456789.123456789123456789, i)) |
+------------------------------------------------------+
|               6145515733034404630.923293528812182425 |
+------------------------------------------------------+

# variable input & frac

#mysql> set tidb_enforce_mpp=1; select sum(round(a, i)) from test.i32 cross join test.t where a >= 0
#+------------------+
#| sum(round(a, i)) |
#+------------------+
#|     132001391875 |
#+------------------+

#mysql> set tidb_enforce_mpp=1; select sum(round(a, i)) from test.i32 cross join test.t where a < 0
#+------------------+
#| sum(round(a, i)) |
#+------------------+
#|    -132001391908 |
#+------------------+

#mysql> set tidb_enforce_mpp=1; select sum(round(a, i)) from test.u32 cross join test.t where a is null
#+------------------+
#| sum(round(a, i)) |
#+------------------+
#|             NULL |
#+------------------+

#mysql> set tidb_enforce_mpp=1; select sum(round(a, i)) from test.u32 cross join test.t
#+------------------+
#| sum(round(a, i)) |
#+------------------+
#|     222093792609 |
#+------------------+

#mysql> set tidb_enforce_mpp=1; select sum(round(a, i)) from test.i64 cross join test.t where a >= 0
#+----------------------+
#| sum(round(a, i))     |
#+----------------------+
#| 51000000000000000274 |
#+----------------------+

#mysql> set tidb_enforce_mpp=1; select sum(round(a, i)) from test.i64 cross join test.t where a < 0
#+-----------------------+
#| sum(round(a, i))      |
#+-----------------------+
#| -51000000000000000274 |
#+-----------------------+

#mysql> set tidb_enforce_mpp=1; select sum(round(a, i)) from test.u64 cross join test.t where a is null
#+------------------+
#| sum(round(a, i)) |
#+------------------+
#|             NULL |
#+------------------+

#mysql> set tidb_enforce_mpp=1; select sum(round(a, i)) from test.u64 cross join test.t
#+-----------------------+
#| sum(round(a, i))      |
#+-----------------------+
#| 520000000000000000274 |
#+-----------------------+

mysql> set tidb_enforce_mpp=1; select sum(round(a, i)) from test.d9 cross join test.t where a >= 0
+------------------+
| sum(round(a, i)) |
+------------------+
|     7600866.2413 |
+------------------+

mysql> set tidb_enforce_mpp=1; select sum(round(a, i)) from test.d9 cross join test.t where a < 0
+------------------+
| sum(round(a, i)) |
+------------------+
|    -7600866.2413 |
+------------------+

mysql> set tidb_enforce_mpp=1; select sum(round(a, i)) from test.d64 cross join test.t where a >= 0
+----------------------------------------------------------------------+
| sum(round(a, i))                                                     |
+----------------------------------------------------------------------+
| 19000000000000000000000000000000000000000000000000000000000000895.12 |
+----------------------------------------------------------------------+

mysql> set tidb_enforce_mpp=1; select sum(round(a, i)) from test.d64 cross join test.t where a < 0
+-----------------------------------------------------------------------+
| sum(round(a, i))                                                      |
+-----------------------------------------------------------------------+
| -19000000000000000000000000000000000000000000000000000000000000895.12 |
+-----------------------------------------------------------------------+
