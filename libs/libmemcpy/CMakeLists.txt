option(ENABLE_MEMCPY_BENCHMARK "Enable Memcpy Benchmark" OFF)
add_library (memcpy STATIC memcpy.cpp)
target_include_directories(memcpy PUBLIC ${TiFlash_SOURCE_DIR}/libs/libcommon/include ${TiFlash_SOURCE_DIR}/libs/libmemcpy)

if (ENABLE_TESTS)
    add_executable(gtests_libmemcpy test/gtest_memcpy.cpp)
    target_include_directories(gtests_libmemcpy PRIVATE ${TiFlash_SOURCE_DIR}/libs/libcommon/include)
    add_test(gtests_libmemcpy gtests_libmemcpy)
    target_link_libraries(gtests_libmemcpy PRIVATE gtest_main)
    if (TEST_LLVM_COVERAGE)
        add_compile_options (gtests_libmemcpy PRIVATE -fprofile-instr-generate -fcoverage-mapping)
    endif ()
endif()

if (ENABLE_MEMCPY_BENCHMARK)
    add_executable(benchmark_memcpy bench/benchmark_memcpy.cpp)
    target_include_directories(benchmark_memcpy PRIVATE ${TiFlash_SOURCE_DIR}/libs/libcommon/include)
    target_link_libraries(benchmark_memcpy PRIVATE benchmark::benchmark)
endif()